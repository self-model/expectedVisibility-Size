---
title: "Expected visibility"
shorttitle: "Expected visibility"

author: 
  - name: "Maya Schipper"
    affiliation: "1"
  - name: "Matan Mazor"
    affiliation: "1"

affiliation:
  - id: "1"
    institution: "University of Oxford"

floatsintext: no
linenumbers: yes
draft: no
mask: no

figurelist: no
tablelist: no
footnotelist: no

classoption: "man"
output: papaja::apa6_word
bibliography: "references.bib"
---

```{r setup, include = FALSE}
library('papaja')
library('pwr')
library('tidyverse')
library('emmeans')
library('afex')
library('dplyr')
library('gridExtra')
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
knitr::opts_knit$set(root.dir = 'C:/Users/schip/Desktop/dissertation experiments/sizeNoOcclusion/experiments')
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r Load and process, echo=FALSE, cache=TRUE}
# load 
df_size <- read.csv('ExpSize/data/jatos_results_data_batch1.csv', sep = ",", header = TRUE)

# tidy 
raw_df_size <- df_size %>%
  dplyr::filter(trial_type=='noisyLetter'& (test_part=='test1' | test_part=='test2')) %>%
  dplyr::select(PROLIFIC_PID, RT, pixel_size_factor, present, correct, confidence, response, presence_key) %>%
  dplyr::rename(subj_id=PROLIFIC_PID,
                size=pixel_size_factor) %>%
  dplyr::mutate(
    RT=as.numeric(RT),
    confidence=as.numeric(confidence),
    present=as.numeric(present),
    response = response == presence_key,
    correct = ifelse(correct == 'true', TRUE, FALSE))

# exclusions
low_accuracy_size <- raw_df_size %>%
  dplyr::group_by(subj_id) %>%
  dplyr::summarise(
    accuracy = mean(correct)) %>%
  dplyr::filter(accuracy<0.5) %>%
  dplyr::pull(subj_id)

too_slow_size <- raw_df_size %>%
  dplyr::group_by(subj_id) %>%
  dplyr::summarise(
    third_quartile_RT = quantile(RT,0.75)) %>%
  dplyr::filter(third_quartile_RT>7000) %>%
  dplyr::pull(subj_id)

too_fast_size <- raw_df_size %>%
  dplyr::group_by(subj_id) %>%
  dplyr::summarise(
    first_quartile_RT = quantile(RT,0.25)) %>%
  dplyr::filter(first_quartile_RT<100) %>%
  dplyr::pull(subj_id)

to_exclude_size <- c(
  low_accuracy_size,
  too_slow_size,
  too_fast_size
) %>% unique()

task_df_size <- raw_df_size %>%
  filter(!(subj_id %in% to_exclude_size))

```

### Participants

`r raw_df_size$subj_id%>%unique()%>%length()` participants took part in the letter-detection task. Participants were excluded if their accuracy fell below 50% (0 participants). We also excluded participants if they had extremely fast (`r too_fast_size%>%length()` participants) or slow (`r too_slow_size%>%length()` participants) reaction times in this task (below 100 milliseconds or above 7 seconds in more than 25% of the trials). Trials with reaction times below 100 milliseconds (`r (raw_df_size%>%filter(RT<100)%>%nrow()/raw_df_size%>%filter(RT>0)%>%nrow())%>%printnum()` of all trials) or above 7 seconds (`r (raw_df_size%>%filter(RT>7000)%>%nrow()/raw_df_size%>%filter(RT>0)%>%nrow())%>%printnum()` of all trials) were excluded from the reaction time analysis.

### Hypotheses 

This study is designed to test whether expected visibility impacts participants’ decisions about presence and absence. 

```{r H1, echo=FALSE, cache=TRUE}
response_RT <- task_df_size %>%
    dplyr::filter(RT > 100 & RT < 7000 & correct == TRUE) %>%  
    dplyr::group_by(subj_id, response) %>%
    dplyr::summarise(RT = median(RT)) %>%
    tidyr::pivot_wider(names_from = response, values_from = RT) %>%
    dplyr::mutate(response_RT = `TRUE` - `FALSE`)
t.test(response_RT$response_RT)
```

*Hypothesis 1 (PRESENCE/ABSENCE RESPONSE TIME)*: We tested the null hypothesis that response times are similar for target-present and target-absent responses, aiming to replicate the finding that decisions about the target-absence are slower than decisions about target-presence [@mazor_metacognitive_2021]. 

We performed paired t-test on the following individual-level contrast from correct trials: $median({RT}_{P})-median({RT}_{A})$. 

This revealed a significant difference in response times for target-present and target-absent responses (`r apa_print(response_RT%>%pull(response_RT)%>%t.test())$full_result`), with overall slower response times for decisions about absence. 

```{r H2, echo=FALSE, cache=TRUE}
RT_size_present <- task_df_size %>%
    dplyr::filter(RT > 100 & RT < 7000 & present == 1 & correct == TRUE) %>%
    dplyr::group_by(subj_id, size) %>%
    dplyr::summarise(RT = median(RT))%>%
    tidyr::pivot_wider(names_from = size, values_from = RT) %>%
    dplyr::mutate(RT_size_present = `5` - `3`)
t.test(RT_size_present$RT_size_present)
```

*Hypothesis 2 (SIZE EFFECT ON REACTION TIME IN PRESENCE)*: We tested the null hypothesis that target-present response times are similar when the display is big and small. 

We performed a paired t-test on the following individual-level contrast from correct trials: $median({RT}_{P, big})-median({RT}_{P, small})$ where P stands for present. 

This revealed a significant difference in response times between big and small stimuli in target-present decisions (`r apa_print(RT_size_present%>%pull(RT_size_present)%>%t.test())$full_result`), with slower response times for big stimuli.

```{r H3, echo=FALSE, cache=TRUE}
RT_size_absent <- task_df_size %>%
    dplyr::filter(RT > 100 & RT < 7000 & present == 0 & correct == TRUE) %>%
    dplyr::group_by(subj_id, size) %>%
    dplyr::summarise(RT = median(RT))%>%
    tidyr::pivot_wider(names_from = size, values_from = RT) %>%
    dplyr::mutate(RT_size_absent = `5` - `3`)
t.test(RT_size_absent$RT_size_absent)
```

*Hypothesis 3 (SIZE EFFECT ON REACTION TIME IN ABSENCE)*: We tested the null hypothesis that target-absent response times are similar when the display is big and small. 

We performed a paired t-test on the following individual-level contrast from correct trials: $median({RT}_{A, big})-median({RT}_{A, small})$ where A stands for absent. 

This revealed a null effect of stimulus size on response time in target-absent decisions (`r apa_print(RT_size_absent%>%pull(RT_size_absent)%>%t.test())$full_result`), with a small but insignificant increase in response times for small stimuli. 

```{r H4, echo=FALSE, cache=TRUE}
RT_size_resp <- inner_join(
  RT_size_present,
  RT_size_absent,
  by = "subj_id") %>%
  mutate(RT_size_resp = RT_size_present - RT_size_absent)
t.test(RT_size_resp$RT_size_resp)
```

*Hypothesis 4 (SIZE RESPONSE INTERACTION ON REACTION TIME)*: We tested the null hypothesis that the effect of stimulus size on reaction time is similar in target-absent and target-present responses. 

We performed a group-level t-test on a subject-level contrast in correct trials only: $(median({RT}_{P,small})-median({RT}_{P,big}))-(median({RT}_{A,small}) - median({RT}_{A,big}))$ where P and A stand for present and absent respectively.

This revealed a significant interaction between stimulus size and target presence (`r apa_print(RT_size_resp%>%pull(RT_size_resp)%>%t.test())$full_result`). 

```{r H5, echo=FALSE, cache=TRUE}
accuracy_size <- task_df_size %>%
  dplyr::group_by(subj_id, size) %>%
  dplyr::summarise(
    hit_rate =(sum(correct & present)+0.5)/(sum(present)+1),
    fa_rate = (sum(!correct & !present)+0.5)/(sum(!present)+1),
    dprime = qnorm(hit_rate)-qnorm(fa_rate),
    criterion = -0.5*(qnorm(hit_rate)+qnorm(fa_rate)))

dprime <- accuracy_size %>%
  dplyr::select(subj_id,size,dprime) %>%
  tidyr::pivot_wider(names_from=size, values_from=dprime) %>%
  dplyr::mutate(dprime_size=`5`-`3`)
t.test(dprime$dprime_size)
```

*Hypothesis 5 (SENSITIVITY)*: We tested the null hypothesis that perceptual sensitivity (measured as $d\prime=z(H)-z(F)$) is equal as a function of the size of the stimulus. To allow the extraction of d’ for participants who committed no false-alarms or misses, we added 0.5 to miss, hit, false-alarm and correct rejection counts [@snodgrass_pragmatics_1988].

We performed a paired t-test on the following subject-level contrast: $d\prime_{big} - d\prime_{small}$. 

We found a significant effect of stimulus size on $d'$ (`r apa_print(dprime%>%pull(dprime_size)%>%t.test())$full_result`), with increased sensitivity for small stimuli. 

```{r H6, echo=FALSE, cache=TRUE}
criterion <- accuracy_size %>%
  dplyr::select(subj_id,size,criterion) %>%
  tidyr::pivot_wider(names_from=size, values_from=criterion) %>%
  dplyr::mutate(criterion_size=`5`-`3`)
t.test(criterion$criterion_size)
```

*Hypothesis 6 (CRITERION)*: We tested the null hypothesis that decision criterion (measured as $c=-0.5(z(H)+z(F))$) is unaffected by the size of the display. To allow the extraction of a decision criterion for participants who committed no false-alarms or misses, we added 0.5 to miss, hit, false-alarm and correct rejection counts [@snodgrass_pragmatics_1988]. 

We performed a paired t-test on the following subject-level contrast: $c_{big} - c_{small}$. 

We found a significantly more conservative criterion for big stimuli (`r apa_print(criterion%>%pull(criterion_size)%>%t.test())$full_result`).

```{r H7, echo=FALSE, cache=TRUE}
response_confidence <- task_df_size %>%
    dplyr::filter(correct == TRUE) %>%
    dplyr::group_by(subj_id, response) %>%
    dplyr::summarise(confidence=mean(confidence)) %>%
    tidyr::pivot_wider(names_from = response, values_from = confidence) %>%
    dplyr::mutate(response_confidence = `TRUE` - `FALSE`)
t.test(response_confidence$response_confidence)
```

*Hypothesis 7 (PRESENCE/ABSENCE CONFIDENCE RATINGS)*: We tested the null hypothesis that confidence ratings are similar for target-present and target-absent responses, aiming to replicate the finding that subjective confidence levels are lower for decisions about absence than decisions about presence [@mazor_metacognitive_2021]. 

We performed a paired t-test on the the following subject-level contrast from correct trials: $mean(confidence_{present}) - mean(confidence_{absent})$

This revealed a significant difference in confidence ratings for decisions about presence and absence (`r apa_print(response_confidence%>%pull(response_confidence)%>%t.test())$full_result`), with higher confidence ratings for present responses. 

```{r H8, echo=FALSE, cache=TRUE}
conf_size_present <- task_df_size %>%
    dplyr::filter(present == 1 & correct == TRUE) %>%
    dplyr::group_by(subj_id, size) %>%
    dplyr::summarise(confidence = mean(confidence)) %>%
    tidyr::pivot_wider(names_from = size, values_from = confidence) %>%
    dplyr::mutate(conf_size_present = `5`-`3`)
t.test(conf_size_present$conf_size_present)
```

*Hypothesis 8 (SIZE EFFECT ON CONFIDENCE IN PRESENCE)*: We tested the null hypothesis that target-present confidence ratings are similar when the stimulus is small or big. 

We performed a paired t-test on the following individual-level contrast from correct trials: $mean(confidence_{P, big}) - mean(confidence)_{P, small}$ where P stands for present. 

This revealed a significant difference in confidence ratings for big and small stimuli in target-present responses (`r apa_print(conf_size_present%>%pull(conf_size_present)%>%t.test())$full_result`), with higher confidence ratings for small stimuli.  
		
```{r H9, echo=FALSE, cache=TRUE}
conf_size_absent <- task_df_size %>%
    dplyr::filter(present == 0 & correct == TRUE) %>%
    dplyr::group_by(subj_id, size) %>%
    dplyr::summarise(confidence = mean(confidence)) %>%
    tidyr::pivot_wider(names_from = size, values_from = confidence) %>%
    dplyr::mutate(conf_size_absent = `5`-`3`)
t.test(conf_size_absent$conf_size_absent)
```

*Hypothesis 9 (SIZE EFFECT ON CONFIDENCE IN ABSENCE)*: We tested the null hypothesis that target-absent confidence ratings are similar when the stimulus is small or big. 

We performed a paired t-test on the following individual-level contrast from correct trials: $mean(confidence_{A, big}) - mean(confidence)_{A, small}$ where A stands for absent. 

This revealed a significant effect of stimulus size on confidence ratings in target-absent responses (`r apa_print(conf_size_absent%>%pull(conf_size_absent)%>%t.test())$full_result`), with higher confidence ratings for big stimuli.  

```{r H10, echo=FALSE, cache=TRUE}
conf_size_resp <- inner_join(
  conf_size_present,
  conf_size_absent,
  by = "subj_id") %>%
  dplyr::mutate(conf_size_resp = conf_size_present - conf_size_absent)
t.test(conf_size_resp$conf_size_resp)
```
		
*Hypothesis 10 (SIZE RESPONSE INTERACTION ON CONFIDENCE)*: We tested the null hypothesis that the effect of stimulus size on confidence ratings is similar in target-present and target-absent responses. 

We performed a group-level t-test on a subject-level contrast in correct trials only: $(mean({confidence}_{P,small})-mean({confidence}_{P,big}))-(mean({confidence}_{A,small}) -mean({confidence}_{A,big}))$ where P and A stand for present and absent respectively.

This revealed a significant interaction effect between stimulus size and target presence on subjective confidence levels (`r apa_print(conf_size_resp%>%pull(conf_size_resp)%>%t.test())$full_result`). 

\newpage

## References
